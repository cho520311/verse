<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>古韻詩詞標註工具 - 瀛社三七同系統</title>
    <style>
        :root {
            --paper-bg: #fdf5e6;
            --ink-black: #2c3e50;
            --classic-red: #a93226; 
            --classic-blue: #2e59a7; 
            --soft-gold: #d4af37;
        }
        body {
            background-color: var(--paper-bg);
            background-image: linear-gradient(rgba(253, 245, 230, 0.7), rgba(253, 245, 230, 0.7)), 
                              url('https://images.unsplash.com/photo-1571168128527-36e655610ec1?q=80&w=2000&auto=format&fit=crop');
            background-size: cover; background-attachment: fixed;
            font-family: "Kaiti TC", "KaiTi", "標楷體", serif;
            margin: 0; display: flex; justify-content: center; padding: 10px;
        }
        .container {
            max-width: 850px;
            width: 100%; background: rgba(255, 255, 255, 0.95); 
            padding: 20px; border: 2px solid #ddd; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header-area { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--classic-red); font-size: 32px; margin: 0; letter-spacing: 6px; font-weight: bold; }
        .instructor { color: var(--ink-black); font-size: 22px; font-weight: bold; margin: 15px 0 5px 0; }
        .subtitle { color: #444; font-size: 18px; margin: 5px 0; font-weight: bold; }
        
        textarea { 
            width: 100%; height: 120px; padding: 15px; font-size: 20px; 
            border-radius: 4px; box-sizing: border-box; 
            font-family: "Kaiti TC", "KaiTi", "標楷體", serif; 
            border: 1px solid #ccc; background: white; 
        }
        .btn-group { display: flex; gap: 10px; justify-content: center; margin: 25px 0; flex-wrap: wrap; }
        button, .btn-link { 
            font-family: "Kaiti TC", "KaiTi", "標楷體", serif;
            font-weight: bold; font-size: 18px; 
            padding: 10px 18px; border: 2px solid var(--classic-red); background: white; 
            color: var(--classic-red); cursor: pointer; border-radius: 8px;
            text-decoration: none; display: inline-block;
        }
        button:hover, .btn-link:hover { background: var(--classic-red); color: white; }
        
        #output { 
            line-height: 3.2; font-size: 32px; color: var(--ink-black); 
            min-height: 150px; padding: 30px 10px; 
            border-top: 2px double var(--soft-gold); text-align: center;
        }
        
        .info-section {
            margin-top: 30px; padding: 20px; border: 1px double var(--soft-gold);
            background: #fffdf9; font-size: 18px; line-height: 1.6; color: #333;
        }
        .info-section h3 { color: var(--classic-red); margin-top: 0; }
        .info-section ul { padding-left: 20px; }
        .info-link { color: var(--classic-blue); text-decoration: underline; }

        ruby { margin: 0 0.15em; }
        rt { font-size: 16px; font-family: Arial, sans-serif; font-weight: bold; cursor: text; min-width: 1em; padding: 0 2px; }
        rt:hover { background: #fff9c4; outline: 1px dashed orange; }
        rt:focus { background: #fff; outline: 2px solid orange; color: black !important; }
        .ping { color: var(--classic-blue) !important; } 
        .ze { color: var(--classic-red) !important; }
        
        @media print {
            textarea, .btn-group, .header-area h1, .info-section { display: none !important; }
            body { background: white; padding: 0; }
            .container { border: none; box-shadow: none; width: 100%; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header-area">
        <h1>古韻詩詞標註</h1>
        <div class="instructor">瀛社 林正三老師 吳秀真老師 指導</div>
        <div class="subtitle">依《音韻闡微》清 · 李光地 / 三七同方式拼音</div>
    </div>
    <textarea id="poemInput" placeholder="請在此輸入詩句..."></textarea>
    
    <div class="btn-group">
        <button onclick="process()">開始轉換</button>
        <button onclick="handlePrint()">列印/PDF</button>
        <a href="#infoBox" class="btn-link">說明聯絡</a>
        <a href="https://tpps.org.tw/home.jsp?lang=tw" target="_blank" class="btn-link">臺灣瀛社詩學會</a>
        <button onclick="location.reload()" style="border-color:#666; color:#666;">刷新重置</button>
    </div>

    <div id="output"></div>

    <div id="infoBox" class="info-section">
        <h3>謝謝您的蒞臨指教</h3>
        <p>有關音標中有 <strong>ir</strong> 或 <strong>er</strong> 的出現，茲解釋如下：</p>
        <ul>
            <li><strong>(1) 區分中古音格局：</strong>研究顯示，在閩南方言的「白讀音」中，ir 和 er 的存在能反映出比《切韻》更古老的音韻對立。</li>
            <li><strong>(2) 反映「支、之、脂、微」之別：</strong>在中古音的分類中，「支、之、脂、微」這幾個韻類在現代優勢腔中大多已經合併（都發 i 音），但在保留老泉州話特徵的層次中，透過 er（[ə]）或 ir（[ɨ]）的加入，可以區分出哪些字屬於「支」韻，哪些字屬於「之、脂」韻。</li>
            <li><strong>(3) 層次辨識：</strong>在學術研究上，這代表該字屬於較古老的歷史層次（如六朝層），用來區別那些在現代腔調中已經聽不出差別的古代韻類。</li>
        </ul>
        <hr style="border: 0; border-top: 1px solid #eee;">
        <p>
            <strong>Podcast:</strong> <a href="https://twgo.io/sound" target="_blank" class="info-link">https://twgo.io/sound</a><br>
            <strong>相關資料:</strong> <a href="https://twgo.io/hello" target="_blank" class="info-link">https://twgo.io/hello</a><br>
            <strong>交流聯絡信箱:</strong> <a href="mailto:cho.yi.hsiang@gmail.com" class="info-link">cho.yi.hsiang@gmail.com</a>
        </p>
    </div>
</div>

<script>
const dict = {
  "𩱷": "muat8", "𩱷": "miat8", "𩎑": "tsuan1", "靐": "pieng7", "䲜": "giap8", "䨻": "pirng7", "𠀽": "lut8", 
  "𠁅": "tshir3", "𠁊": "song2", "𠂁": "tam2", "𠃀": "sui5", "𠃊": "in2", "𠃚": "kiu1", "𠃢": "sir3", "𠇗": "khua1", "𠌖": "kiong5", "𠍜": "ti7", 
  "𠎝": "khian1", "𠐩": "tham2", "𠑆": "thian2", "𠔺": "kham1", "𠘂": "sio1", "𠡝": "git8", "𠣬": "sun2", "𠥗": "kui2", "𠮌": "tsut4", "𠹝": "siu5", 
  "𠹝": "io3", "𠺑": "siau3", "𠺛": "to7", "𡀾": "gap8", "𡍖": "tai7", "𡔣": "kiat4", "𡔣": "khiat4", "𡕏": "song2", "𡕗": "hai7", "𡘬": "tong1", 
  "𡙳": "kiok4", "𡚮": "kiu2", "𡝐": "ta5", "𡠆": "khio3", "𡠖": "ho7", "𡠼": "sio1", "𡣬": "uan1", "𡤉": "pin5", "𡦲": "kau3", "𡦳": "hau3", 
  "𡧽": "hong2", "𡯋": "kan1", "𡰅": "hut8", "𡰞": "tuan1", "𡴊": "khak4", "𡺛": "khiong1", "𡼄": "tiat8", "𡿦": "khun1", "𢀼": "hiu5", "𢄻": "san2", 
  "𢆞": "kian2", "𢇓": "kit8", "𢈕": "pai3", "𢊿": "hui1", "𢎛": "tsiat4", "𢏏": "mi5", "𢓡": "i5", "𢔅": "tong1", "𢖔": "pau3", "𢚿": "lun2", 
  "𢛳": "tirk4", "𢝰": "tsong2", "𢡍": "kirk4", "𢡹": "siong6", "𢣗": "mo2", "𢥠": "sang1", "𢦒": "tsai1", "𢦵": "mio5", "𢧻": "tat4", "𢬟": "tshiu1", 
  "𢮛": "suan7", "𢱈": "ka3", "𢶡": "khiau3", "𢶡": "khierk4", "𢹎": "jiau2", "𢻢": "liau2", "𢻰": "hai1", "𢼂": "kau3", "𢼛": "kirk4", "𢼛": "kirk4", 
  "𢼹": "phoo1", "𢽚": "tok4", "𢽚": "tak4", "𢽣": "kham1", "𢾁": "ui5", "𢾊": "tirng5", "𢾎": "tshun2", "𢿏": "phau1", "𢿢": "luan7", "𢿦": "tirng5", 
  "𢿱": "san2", "𢿱": "san3", "𣀃": "liam5", "𣀩": "kuai3", "𣅔": "tsirk4", "𣅕": "it8", "𣇗": "sin1", "𣊓": "niap8", "𣑍": "kua2", "𣕏": "tuan2", 
  "𣖄": "tshiau1", "𣖅": "te5", "𣚓": "kuan3", "𣛒": "le7", "𣛗": "lok8", "𣞈": "piau5", "𣠑": "pong7", "𣠯": "suan1", "𣡖": "pai7", "𣢫": "ong2", 
  "𣧺": "san1", "𣫎": "sok4", "𣽍": "ki7", "𣿂": "sui2", "𤃨": "lam7", "𤄒": "kan2", "𤉐": "tsak8", "𤑛": "hun3", "𤣆": "thin1", "𤣆": "tan5", 
  "𤣆": "lian5", "𤤴": "kak4", "𤧚": "tshong1", "𤧩": "tuan3", "𤬓": "liam2", "𤭙": "ham5", "𤱹": "thieng2", "𤳐": "tsir3", "𤺃": "iau5", "𥂁": "iam5", 
  "𥂫": "tsan5", "𥈄": "thang3", "𥈟": "sio2", "𥊔": "hui2", "𥋱": "mit8", "𥎞": "tsuan2", "𥎞": "tsuan3", "𥎞": "tshuan3", "𥗰": "nau5", "𥢐": "ko1", 
  "𥲔": "tiok4", "𥹄": "mi5", "𥼗": "tshoo1", "𦍙": "siong5", "𦒧": "hirk4", "𦔮": "git8", "𦔮": "tiap4", "𦘹": "guat8", "𦟞": "hiau1", "𦠡": "sierk4", 
  "𦦔": "hui7", "𦦷": "hui7", "𦨳": "goo5", "𦮶": "bun2", "𦯐": "siau5", "𦻐": "tau7", "𦼉": "huan5", "𦼧": "sat4", "𧂇": "tam5", "𧃱": "nirng5", 
  "𧆌": "tse1", "𧈱": "tirk8", "𧔊": "tian5", "𧘘": "u5", "𧘿": "tsieng1", "𧟵": "pirk8", "𧠥": "tshir1", "𧢌": "ko1", "𧢗": "tio1", "𧧢": "hong1", 
  "𧧢": "hong2", "𧧢": "hong2", "𧨍": "he6", "𧬁": "ho7", "𧱦": "tio3", "𧱹": "phoo1", "𧸩": "sun3", "𧻷": "poo1", "𧽮": "tit8", "𨐖": "sat4", 
  "𨔥": "tsian1", "𨛲": "nian5", "𨛲": "nieng5", "𨝲": "ko1", "𨡻": "siu1", "𨦃": "to2", "𨩪": "thian2", "𨪴": "ke1", "𨯝": "tue6", "𨶩": "hap8", 
  "𨶪": "kiau2", "𨷭": "tian5", "𨾎": "kui5", "𩁚": "nan5", "𩃬": "im1", "𩆊": "buan7", "𩌥": "hak4", "𩒣": "tsim6", "𩓏": "khieng2", "𩕧": "sun3", 
  "𩹟": "nai7", "𩻼": "te7", "𪀐": "pip8", "𪀐": "kiap8", "𪁁": "kiok8", "苦": "khoo2", "牠": "tho1", "嗯": "hm3", "岪": "hut4", "嵂": "lut8", 
  "砆": "hu1", "梬": "ieng2", "浰": "li7", "翱": "go5", "袘": "i5", "𧛖": "i5", "鵔": "tsun3", "鸃": "gi5", "鵞": "go5", "𡧧": "gi5", 
  "䳘": "go5", "礚": "khap4", "卨": "siat4", "妳": "ni2", "您": "lin2", "們": "mun7", "陁": "to5", "輛": "liong7", "嗎": "ma7", "蒂": "te3", 
  "埼": "ki5", "濦": "in2", "䱭": "kirng3", "鰫": "iong5", "澔": "ho6", "躪": "lin7", "蠼": "kiok4", "偨": "tshir1", "藰": "liu2", "琘": "min5", 
  "扦": "tshian1", "貏": "pi6", "崣": "ui2", "嶻": "tsat8", "嶄": "tsam5", "嵷": "tsong1", "閕": "ha1", "隝": "to2"
};

function process() {
    const input = document.getElementById('poemInput').value;
    const outputDiv = document.getElementById('output');
    if (!input.trim()) {
        alert("請輸入詩句再進行轉換。");
        return;
    }
    
    let resultHTML = "";
    const punctuations = /[，。？！；：、「」『』（）—…\s\d]/;
    const hanChar = /[\u4E00-\u9FFF]/;
    for (let char of input) {
        if (char === '\n') { 
            resultHTML += '<br>';
            continue; 
        }
        if (!hanChar.test(char) || punctuations.test(char)) {
            resultHTML += `<span>${char}</span>`;
            continue;
        }
        let pinyin = dict[char] || "?";
        let colorClass = "";
        if (pinyin !== "?") {
            const tone = pinyin.slice(-1);
            colorClass = (tone === "1" || tone === "5") ? "ping" : "ze";
        }
        resultHTML += `<ruby>${char}<rt contenteditable="true" class="${colorClass}">${pinyin}</rt></ruby>`;
    }
    
    resultHTML += `
    <div class="note-footer" style="color: blue; font-size: 20px; margin-top:15px;">
        【上取聲母定清濁，下取韻母定四聲】<br>
        聯絡：<a href="mailto:cho.yi.hsiang@gmail.com" style="color:#2e59a7; text-decoration:underline;">cho.yi.hsiang@gmail.com</a>
    </div>`;
    outputDiv.innerHTML = resultHTML;
}

function handlePrint() {
    const input = document.getElementById('poemInput').value.trim();
    if (input) {
        // 擷取第一行文字
        const firstLine = input.split('\n')[0];
        // 過濾掉非中文字元（保留全部中文字）
        const hanOnly = firstLine.replace(/[^\u4E00-\u9FFF]/g, '');
        // 將處理後的第一行中文字設為網頁標題（即存檔檔名）
        const fileName = hanOnly || "古韻詩詞";
        document.title = fileName;
    }
    window.print();
}
</script>
</body>
</html>
